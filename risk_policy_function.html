<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Policy Management Module</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Slate Gray Professional -->
    <!-- Application Structure Plan: A role-based, single-page dashboard application. The core interaction is a user-role switcher at the top, which dynamically re-renders the entire UI to reflect the permissions and views of the selected role (Departmental User, RM User, RM Head). This structure was chosen because the source FRS is fundamentally about role-based access and workflows. This design makes those abstract requirements tangible and allows stakeholders to experience the system from each user's perspective on a single page. The main components are a filter panel, a policy list, and a conditional "Pending Approval" queue for the RM Head. Modals are used for actions like adding, editing, and reviewing to maintain the single-page context. -->
    <!-- Visualization & Content Choices: 
        - Report Info: User Roles & Permissions -> Goal: Demonstrate access control -> Viz/Presentation: Interactive role-switcher (buttons) -> Interaction: Clicking a role re-renders the UI, showing/hiding buttons and sections. -> Justification: Directly simulates the core functional requirement of role-based views in an intuitive way. -> Method: HTML/JS.
        - Report Info: Search/Filter requirements -> Goal: Simulate policy discovery -> Viz/Presentation: HTML form with dropdowns and text inputs. -> Interaction: Changing filter values triggers a JS function to filter and re-render the policy list. -> Justification: Provides a realistic prototype of the search functionality described. -> Method: HTML/JS.
        - Report Info: Policy list display -> Goal: Present tabular data clearly -> Viz/Presentation: HTML table styled with Tailwind CSS, using colored badges for status. -> Interaction: Action buttons in the table trigger modals. -> Justification: A table is the standard and most effective UI for structured data lists. -> Method: HTML/Tailwind.
        - Report Info: Add/Edit/Review/Delete actions -> Goal: Simulate the C.R.U.D. and approval workflow -> Viz/Presentation: Modals for forms and review screens. -> Interaction: Modals appear on button clicks. The "Review" modal for the RM Head visually highlights changes. -> Justification: Modals focus the user's task without leaving the main dashboard, which is ideal for an SPA and clearly demonstrates the workflow steps. -> Method: HTML/JS/Tailwind.
        - Report Info: Approval Workflow -> Goal: Visualize the state changes of a policy -> Viz/Presentation: A separate "Pending Approval" table visible only to the RM Head. -> Interaction: Approving/rejecting an item in the review modal moves it from the pending data array to the main policies array (or removes it) and re-renders the view. -> Justification: Clearly separates the RM Head's primary task and makes the approval process tangible. -> Method: HTML/JS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        .table-responsive {
            display: block;
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
    </style>
</head>
<body class="text-slate-800">

    <div id="app" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-sm sticky top-0 z-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex flex-col sm:flex-row justify-between items-center">
                    <div>
                        <h1 class="text-2xl font-bold text-slate-900">Risk Policy Module</h1>
                        <p class="text-sm text-slate-500">A central repository for all risk-related policies and SOPs.</p>
                    </div>
                    <div class="mt-4 sm:mt-0">
                        <span class="text-sm font-medium text-slate-600 mr-2">View as:</span>
                        <div id="role-switcher" class="inline-flex rounded-md shadow-sm" role="group"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <!-- Approval Queue - Visible to RM Head only -->
                <div id="approval-queue-section" class="mb-8 hidden"></div>
                
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="bg-white p-6 rounded-lg shadow-sm"></div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="bg-white mt-8">
            <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm text-slate-500">
                <p>&copy; 2025 Corporate Risk Management. All Rights Reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Modal -->
    <div id="modal-container" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 modal-overlay hidden">
        <div id="modal-content" class="bg-white rounded-lg shadow-xl w-full max-w-2xl transform scale-95 modal-content">
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-4 border-b">
                <h3 id="modal-title" class="text-xl font-semibold text-slate-900"></h3>
                <button id="modal-close-btn" class="text-slate-400 hover:text-slate-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <!-- Modal Body -->
            <div id="modal-body" class="p-6 max-h-[70vh] overflow-y-auto"></div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const ROLES = {
                DEPT_USER: 'Departmental User',
                RM_USER: 'Risk Management User',
                RM_HEAD: 'Risk Management Head'
            };

            let currentUserRole = ROLES.DEPT_USER;

            const teams = ['Risk', 'Compliance', 'IT Security', 'Operations', 'Finance', 'Human Resources', 'Internal Audit'];
            
            let policies = [
                { id: 1, name: 'Data Governance Policy v2.1', team: 'IT Security', releaseTime: '2025-05-20', type: 'Policy', effective: true, attachment: 'data_governance_v2.1.pdf', changes: null, status: 'approved' },
                { id: 2, name: 'SOP for Vendor Onboarding', team: 'Operations', releaseTime: '2025-05-15', type: 'SOP', effective: true, attachment: 'sop_vendor_onboarding.pdf', changes: null, status: 'approved' },
                { id: 3, name: 'Incident Response Plan', team: 'IT Security', releaseTime: '2025-05-01', type: 'Policy', effective: true, attachment: 'incident_response_plan.pdf', changes: null, status: 'approved' },
                { id: 4, name: 'Financial Reporting Standards', team: 'Finance', releaseTime: '2025-04-28', type: 'Policy', effective: true, attachment: 'financial_reporting_standards.pdf', changes: null, status: 'approved' },
                { id: 5, name: 'Employee Code of Conduct v3.0', team: 'Human Resources', releaseTime: '2025-04-22', type: 'Policy', effective: true, attachment: 'code_of_conduct_v3.pdf', changes: null, status: 'approved' },
                { id: 6, name: 'SOP for Quarterly Audits', team: 'Internal Audit', releaseTime: '2025-04-10', type: 'SOP', effective: false, attachment: 'sop_quarterly_audits.pdf', changes: null, status: 'approved' },
                { id: 7, name: 'Compliance Training Manual', team: 'Compliance', releaseTime: '2025-03-30', type: 'SOP', effective: true, attachment: 'compliance_training.pdf', changes: null, status: 'approved' },
                { id: 8, name: 'Insider Trading Policy', team: 'Compliance', releaseTime: '2025-03-15', type: 'Policy', effective: true, attachment: 'insider_trading_policy.pdf', changes: null, status: 'approved' },
                { id: 9, name: 'Remote Work Security Policy', team: 'IT Security', releaseTime: '2025-02-28', type: 'Policy', effective: true, attachment: 'remote_work_policy.pdf', changes: null, status: 'approved' },
                { id: 10, name: 'Risk Assessment Framework', team: 'Risk', releaseTime: '2025-02-19', type: 'Policy', effective: true, attachment: 'risk_assessment_framework.pdf', changes: null, status: 'approved' },
                { id: 11, name: 'Disaster Recovery Plan', team: 'IT Security', releaseTime: '2025-01-25', type: 'Policy', effective: true, attachment: 'disaster_recovery_plan.pdf', changes: null, status: 'approved' }
            ];

            let pendingPolicies = [
                { id: 12, name: 'New Expense Reimbursement SOP', team: 'Finance', releaseTime: '2025-06-17', type: 'SOP', effective: true, attachment: 'expense_reimbursement_sop.pdf', changes: { type: 'New' }, status: 'pending', submittedBy: 'Alice (RM User)', submissionDate: '2025-06-16' },
                { id: 4, name: 'Financial Reporting Standards', team: 'Finance', releaseTime: '2025-04-28', type: 'Policy', effective: true, attachment: 'financial_reporting_standards_v2.pdf', changes: { type: 'Edit', original: { attachment: 'financial_reporting_standards.pdf' } }, status: 'pending', submittedBy: 'Bob (RM User)', submissionDate: '2025-06-15' },
                 { id: 6, name: 'SOP for Quarterly Audits', team: 'Internal Audit', releaseTime: '2025-04-10', type: 'SOP', effective: false, attachment: 'sop_quarterly_audits.pdf', changes: { type: 'Delete' }, status: 'pending_deletion', submittedBy: 'Alice (RM User)', submissionDate: '2025-06-14' }
            ];

            const appState = {
                filters: {
                    team: '',
                    startDate: '',
                    endDate: '',
                    status: '',
                    type: '',
                    name: '',
                    fuzzy: ''
                }
            };

            function render() {
                renderRoleSwitcher();
                renderApprovalQueue();
                renderDashboard();
            }

            function renderRoleSwitcher() {
                const container = document.getElementById('role-switcher');
                container.innerHTML = Object.values(ROLES).map((role, index) => `
                    <button 
                        data-role="${role}" 
                        class="role-btn px-4 py-2 text-sm font-medium transition-colors duration-200 
                        ${currentUserRole === role ? 'bg-slate-800 text-white z-10' : 'bg-white text-slate-700 hover:bg-slate-100'}
                        ${index === 0 ? 'rounded-l-md' : ''}
                        ${index === Object.values(ROLES).length - 1 ? 'rounded-r-md' : ''}
                        border border-slate-300 -ml-px"
                    >
                        ${role}
                    </button>
                `).join('');
                container.querySelectorAll('.role-btn').forEach(btn => btn.addEventListener('click', () => {
                    currentUserRole = btn.dataset.role;
                    render();
                }));
            }
            
            function renderApprovalQueue() {
                const container = document.getElementById('approval-queue-section');
                if (currentUserRole !== ROLES.RM_HEAD) {
                    container.classList.add('hidden');
                    return;
                }
                container.classList.remove('hidden');
                
                const pendingCount = pendingPolicies.length;
                container.innerHTML = `
                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 rounded-lg shadow-sm">
                        <h2 class="text-xl font-semibold text-yellow-900 mb-1">Approval Queue (${pendingCount})</h2>
                        <p class="text-sm text-yellow-700 mb-4">The following policy submissions require your review. Please review them for accuracy and completeness before they are published or removed.</p>
                        <div class="table-responsive">
                            <table class="w-full text-sm text-left text-slate-600">
                                <thead class="text-xs text-slate-700 uppercase bg-yellow-100">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Policy Name</th>
                                        <th scope="col" class="px-6 py-3">Change Type</th>
                                        <th scope="col" class="px-6 py-3">Submitted By</th>
                                        <th scope="col" class="px-6 py-3">Submission Date</th>
                                        <th scope="col" class="px-6 py-3 text-center">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${pendingPolicies.map(p => `
                                        <tr class="bg-white border-b hover:bg-yellow-50">
                                            <td class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap">${p.name}</td>
                                            <td class="px-6 py-4">
                                                <span class="px-2 py-1 text-xs font-medium rounded-full 
                                                    ${p.changes.type === 'New' ? 'bg-blue-100 text-blue-800' : ''}
                                                    ${p.changes.type === 'Edit' ? 'bg-yellow-100 text-yellow-800' : ''}
                                                    ${p.changes.type === 'Delete' ? 'bg-red-100 text-red-800' : ''}
                                                ">${p.changes.type}</span>
                                            </td>
                                            <td class="px-6 py-4">${p.submittedBy}</td>
                                            <td class="px-6 py-4">${p.submissionDate}</td>
                                            <td class="px-6 py-4 text-center">
                                                <button class="review-btn font-medium text-blue-600 hover:underline" data-id="${p.id}">Review</button>
                                            </td>
                                        </tr>
                                    `).join('') || `<tr><td colspan="5" class="text-center py-4 text-slate-500">The approval queue is empty.</td></tr>`}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;

                container.querySelectorAll('.review-btn').forEach(btn => btn.addEventListener('click', (e) => handleReview(e.target.dataset.id)));
            }

            function renderDashboard() {
                const container = document.getElementById('dashboard-section');
                const canEdit = currentUserRole === ROLES.RM_USER || currentUserRole === ROLES.RM_HEAD;
                const filteredPolicies = getFilteredPolicies();

                container.innerHTML = `
                    <div>
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                            <div>
                                <h2 class="text-xl font-semibold text-slate-900">Policy Dashboard</h2>
                                <p class="text-sm text-slate-500 mt-1">Search for policies or view the most recently published items.</p>
                            </div>
                            ${canEdit ? `<button id="add-policy-btn" class="add-btn mt-4 md:mt-0 flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                                Add Policy
                            </button>` : ''}
                        </div>

                        <!-- Filters -->
                        <div class="mb-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            ${renderFilterPanel()}
                        </div>
                        <div class="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="relative">
                                <label for="name-search" class="block mb-2 text-sm font-medium text-slate-700">Name Search</label>
                                <input type="text" id="name-search" value="${appState.filters.name}" class="filter-input bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="Search by policy name...">
                            </div>
                            <div class="relative">
                                <label for="fuzzy-search" class="block mb-2 text-sm font-medium text-slate-700">Fuzzy Search</label>
                                <input type="text" id="fuzzy-search" value="${appState.filters.fuzzy}" class="filter-input bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="Intelligent search...">
                            </div>
                        </div>

                        <!-- Policy List -->
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">Latest Policies</h3>
                        <div class="table-responsive">
                            <table class="w-full text-sm text-left text-slate-600">
                                <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Policy Name</th>
                                        <th scope="col" class="px-6 py-3">Issuing Team</th>
                                        <th scope="col" class="px-6 py-3">Release Time</th>
                                        <th scope="col" class="px-6 py-3">Status</th>
                                        <th scope="col" class="px-6 py-3 text-center">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${filteredPolicies.sort((a, b) => new Date(b.releaseTime) - new Date(a.releaseTime)).slice(0, 10).map(p => renderPolicyRow(p, canEdit)).join('') || `<tr><td colspan="5" class="text-center py-4 text-slate-500">No policies match the current filters.</td></tr>`}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                attachDashboardListeners();
            }

            function renderFilterPanel() {
                return `
                    <div>
                        <label for="team-filter" class="block mb-2 text-sm font-medium text-slate-700">Issuing Team</label>
                        <select id="team-filter" class="filter-input bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option value="">All Teams</option>
                            ${teams.map(t => `<option value="${t}" ${appState.filters.team === t ? 'selected' : ''}>${t}</option>`).join('')}
                        </select>
                    </div>
                    <div>
                        <label for="status-filter" class="block mb-2 text-sm font-medium text-slate-700">Effectiveness</label>
                        <select id="status-filter" class="filter-input bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option value="">All</option>
                            <option value="true" ${appState.filters.status === 'true' ? 'selected' : ''}>Effective</option>
                            <option value="false" ${appState.filters.status === 'false' ? 'selected' : ''}>Ineffective</option>
                        </select>
                    </div>
                    <div>
                        <label for="type-filter" class="block mb-2 text-sm font-medium text-slate-700">Policy Type</label>
                        <select id="type-filter" class="filter-input bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option value="">All Types</option>
                            <option value="Policy" ${appState.filters.type === 'Policy' ? 'selected' : ''}>Policy</option>
                            <option value="SOP" ${appState.filters.type === 'SOP' ? 'selected' : ''}>SOP</option>
                        </select>
                    </div>
                `;
            }

            function renderPolicyRow(policy, canEdit) {
                return `
                    <tr class="bg-white border-b hover:bg-slate-50">
                        <td class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap">${policy.name}</td>
                        <td class="px-6 py-4">${policy.team}</td>
                        <td class="px-6 py-4">${policy.releaseTime}</td>
                        <td class="px-6 py-4">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${policy.effective ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${policy.effective ? 'Effective' : 'Ineffective'}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-center whitespace-nowrap">
                            <button class="view-btn font-medium text-blue-600 hover:underline" data-id="${policy.id}">View</button>
                            ${canEdit ? `
                                <button class="edit-btn font-medium text-amber-600 hover:underline ml-4" data-id="${policy.id}">Edit</button>
                                <button class="delete-btn font-medium text-red-600 hover:underline ml-4" data-id="${policy.id}">Delete</button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            }

            function attachDashboardListeners() {
                const addBtn = document.getElementById('add-policy-btn');
                if (addBtn) addBtn.addEventListener('click', handleAdd);

                document.querySelectorAll('.filter-input').forEach(input => {
                    input.addEventListener('change', handleFilterChange);
                });

                document.getElementById('name-search').addEventListener('input', handleFilterChange);
                document.getElementById('fuzzy-search').addEventListener('input', handleFilterChange);
                
                document.querySelectorAll('.view-btn').forEach(btn => btn.addEventListener('click', (e) => handleView(e.target.dataset.id)));
                document.querySelectorAll('.edit-btn').forEach(btn => btn.addEventListener('click', (e) => handleEdit(e.target.dataset.id)));
                document.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', (e) => handleDelete(e.target.dataset.id)));
            }

            function handleFilterChange(e) {
                const filterId = e.target.id;
                const value = e.target.value;

                if (filterId === 'team-filter') appState.filters.team = value;
                if (filterId === 'status-filter') appState.filters.status = value;
                if (filterId === 'type-filter') appState.filters.type = value;
                if (filterId === 'name-search') appState.filters.name = value;
                if (filterId === 'fuzzy-search') appState.filters.fuzzy = value;

                renderDashboard();
            }

            function getFilteredPolicies() {
                return policies.filter(p => {
                    const { team, status, type, name, fuzzy } = appState.filters;
                    if (team && p.team !== team) return false;
                    if (status && String(p.effective) !== status) return false;
                    if (type && p.type !== type) return false;
                    if (name && !p.name.toLowerCase().includes(name.toLowerCase())) return false;
                    if (fuzzy) {
                        const fuzzyLower = fuzzy.toLowerCase();
                        const searchString = `${p.name} ${p.team} ${p.type}`.toLowerCase();
                        if (!searchString.includes(fuzzyLower)) return false;
                    }
                    return true;
                });
            }

            function handleView(id) {
                const policy = policies.find(p => p.id == id);
                openModal('View Policy Details', `
                    <dl class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                        <div class="md:col-span-2"><dt class="font-semibold text-slate-800">Policy Name</dt><dd class="text-slate-600">${policy.name}</dd></div>
                        <div><dt class="font-semibold text-slate-800">Issuing Team</dt><dd class="text-slate-600">${policy.team}</dd></div>
                        <div><dt class="font-semibold text-slate-800">Release Time</dt><dd class="text-slate-600">${policy.releaseTime}</dd></div>
                        <div><dt class="font-semibold text-slate-800">Effectiveness Status</dt><dd class="text-slate-600">${policy.effective ? 'Effective' : 'Ineffective'}</dd></div>
                        <div><dt class="font-semibold text-slate-800">Policy Type</dt><dd class="text-slate-600">${policy.type}</dd></div>
                        <div class="md:col-span-2"><dt class="font-semibold text-slate-800">Attachment</dt><dd class="text-blue-600 flex items-center mt-1">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            ${policy.attachment}
                        </dd></div>
                    </dl>
                    <div class="mt-6 p-4 bg-slate-50 rounded-lg">
                        <h4 class="font-semibold text-slate-800 mb-2">Attachment Preview</h4>
                        <div class="w-full h-48 bg-slate-200 rounded flex items-center justify-center">
                            <p class="text-slate-500">Attachment preview would be displayed here.</p>
                        </div>
                    </div>
                     <p class="text-xs text-center text-slate-400 mt-4">Downloading attachments is disabled for this user role.</p>
                `);
            }

            function handleAdd() {
                openModal('Add New Policy', renderForm());
                document.getElementById('policy-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    // In a real app, this would submit to the backend. Here we simulate it.
                    alert('Submission simulated. The RM Head will be notified to review the new policy.');
                    closeModal();
                });
            }

            function handleEdit(id) {
                const policy = policies.find(p => p.id == id);
                openModal('Edit Policy', renderForm(policy));
                document.getElementById('policy-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    alert('Edit submission simulated. The RM Head will be notified to review the changes.');
                    closeModal();
                });
            }
            
            function handleDelete(id) {
                 const policy = policies.find(p => p.id == id);
                 openModal('Confirm Deletion', `
                    <p class="text-slate-700">Are you sure you want to propose the deletion of the policy: <strong class="text-slate-900">${policy.name}</strong>?</p>
                    <p class="text-sm text-slate-500 mt-2">This action cannot be undone. The deletion request will be sent to the RM Head for final approval.</p>
                    <div class="mt-6 flex justify-end gap-3">
                         <button id="modal-cancel-btn" class="px-4 py-2 bg-white text-slate-700 border border-slate-300 rounded-md hover:bg-slate-50">Cancel</button>
                         <button id="modal-confirm-delete-btn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Confirm Deletion</button>
                    </div>
                 `);
                 document.getElementById('modal-cancel-btn').addEventListener('click', closeModal);
                 document.getElementById('modal-confirm-delete-btn').addEventListener('click', () => {
                     alert('Deletion proposal submitted. The RM Head will be notified for review.');
                     closeModal();
                 });
            }
            
            function handleReview(id) {
                const policy = pendingPolicies.find(p => p.id == id);
                const isDelete = policy.changes.type === 'Delete';

                let reviewContent = '';
                if (policy.changes.type === 'New') {
                    reviewContent = `
                        <h4 class="font-semibold mb-2 text-slate-800">New Policy Details:</h4>
                        <dl class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 bg-green-50 p-4 rounded-lg border border-green-200">
                           <div class="md:col-span-2"><dt class="font-semibold">Policy Name</dt><dd>${policy.name}</dd></div>
                           <div><dt class="font-semibold">Issuing Team</dt><dd>${policy.team}</dd></div>
                           <div><dt class="font-semibold">Release Time</dt><dd>${policy.releaseTime}</dd></div>
                           <div><dt class="font-semibold">Effectiveness</dt><dd>${policy.effective ? 'Effective' : 'Ineffective'}</dd></div>
                           <div><dt class="font-semibold">Type</dt><dd>${policy.type}</dd></div>
                           <div class="md:col-span-2"><dt class="font-semibold">Attachment</dt><dd class="text-blue-600">${policy.attachment}</dd></div>
                        </dl>`;
                } else if (policy.changes.type === 'Edit') {
                    const original = policies.find(p => p.id == id);
                    reviewContent = `
                        <h4 class="font-semibold mb-2 text-slate-800">Review Changes:</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                                <h5 class="font-bold text-red-800">Before</h5>
                                <dl class="mt-2 space-y-2 text-sm"><dt class="font-semibold">Attachment:</dt><dd class="text-red-700 line-through">${original.attachment}</dd></dl>
                            </div>
                            <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                                <h5 class="font-bold text-green-800">After</h5>
                                 <dl class="mt-2 space-y-2 text-sm"><dt class="font-semibold">Attachment:</dt><dd class="text-green-700">${policy.attachment}</dd></dl>
                            </div>
                        </div>`;
                } else if (isDelete) {
                    reviewContent = `
                        <h4 class="font-semibold mb-2 text-slate-800">Confirm Deletion:</h4>
                        <p class="text-slate-700">Please confirm the permanent deletion of the policy: <strong class="text-slate-900">${policy.name}</strong>.</p>
                        <div class="mt-4 bg-red-50 p-4 rounded-lg border border-red-200">
                            <dl class="grid grid-cols-2 gap-4 text-sm">
                                <div><dt class="font-semibold">Issuing Team</dt><dd>${policy.team}</dd></div>
                                <div><dt class="font-semibold">Release Time</dt><dd>${policy.releaseTime}</dd></div>
                            </dl>
                        </div>
                    `;
                }
                
                openModal(`Review Submission: ${policy.name}`, `
                    ${reviewContent}
                    <div class="mt-6 p-4 bg-slate-50 rounded-lg">
                        <label for="review-comments" class="font-semibold text-slate-800 mb-2 block">Rejection Reason (if applicable):</label>
                        <textarea id="review-comments" class="w-full p-2 border border-slate-300 rounded-md" rows="3" placeholder="Provide comments for rejection..."></textarea>
                    </div>
                    <div class="mt-6 flex justify-end gap-3">
                        <button id="reject-btn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Reject</button>
                        <button id="approve-btn" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">${isDelete ? 'Confirm Deletion' : 'Approve'}</button>
                    </div>
                `);

                document.getElementById('approve-btn').addEventListener('click', () => handleDecision(policy.id, 'approve'));
                document.getElementById('reject-btn').addEventListener('click', () => handleDecision(policy.id, 'reject'));
            }

            function handleDecision(id, decision) {
                const index = pendingPolicies.findIndex(p => p.id == id);
                if (index === -1) return;

                const [policy] = pendingPolicies.splice(index, 1);
                
                if (decision === 'approve') {
                    if (policy.changes.type === 'New') {
                        policies.push({ ...policy, status: 'approved', changes: null });
                    } else if (policy.changes.type === 'Edit') {
                        const originalIndex = policies.findIndex(p => p.id == id);
                        if (originalIndex > -1) {
                            policies[originalIndex] = { ...policies[originalIndex], attachment: policy.attachment };
                        }
                    } else if (policy.changes.type === 'Delete') {
                        const policyIndex = policies.findIndex(p => p.id == id);
                        if(policyIndex > -1) policies.splice(policyIndex, 1);
                    }
                    alert(`Submission for "${policy.name}" has been approved.`);
                } else {
                     alert(`Submission for "${policy.name}" has been rejected.`);
                }
                
                closeModal();
                render();
            }

            function renderForm(policy = {}) {
                const isEdit = !!policy.id;
                return `
                    <form id="policy-form" class="space-y-6">
                        <div>
                            <label for="policy-name" class="block text-sm font-medium text-slate-700">Policy Name</label>
                            <input type="text" id="policy-name" name="name" value="${policy.name || ''}" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="issuing-team" class="block text-sm font-medium text-slate-700">Issuing Team</label>
                                <select id="issuing-team" name="team" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    ${teams.map(t => `<option value="${t}" ${policy.team === t ? 'selected' : ''}>${t}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label for="release-time" class="block text-sm font-medium text-slate-700">Release Time</label>
                                <input type="date" id="release-time" name="releaseTime" value="${policy.releaseTime || new Date().toISOString().split('T')[0]}" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                             <div>
                                <label class="block text-sm font-medium text-slate-700">Policy Type</label>
                                <div class="mt-2 flex gap-4">
                                    <label class="inline-flex items-center"><input type="radio" name="type" value="Policy" ${policy.type === 'Policy' || !isEdit ? 'checked' : ''} class="text-blue-600 focus:ring-blue-500"> <span class="ml-2">Policy</span></label>
                                    <label class="inline-flex items-center"><input type="radio" name="type" value="SOP" ${policy.type === 'SOP' ? 'checked' : ''} class="text-blue-600 focus:ring-blue-500"> <span class="ml-2">SOP</span></label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700">Effectiveness Status</label>
                                <div class="mt-2 flex gap-4">
                                    <label class="inline-flex items-center"><input type="radio" name="effective" value="true" ${policy.effective || !isEdit ? 'checked' : ''} class="text-blue-600 focus:ring-blue-500"> <span class="ml-2">Effective</span></label>
                                    <label class="inline-flex items-center"><input type="radio" name="effective" value="false" ${!policy.effective && isEdit ? 'checked' : ''} class="text-blue-600 focus:ring-blue-500"> <span class="ml-2">Ineffective</span></label>
                                </div>
                            </div>
                        </div>
                        <div>
                             <label for="attachment" class="block text-sm font-medium text-slate-700">Attachment</label>
                             <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-slate-300 border-dashed rounded-md">
                                <div class="space-y-1 text-center">
                                    <svg class="mx-auto h-12 w-12 text-slate-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                                    <div class="flex text-sm text-slate-600">
                                        <label for="file-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500">
                                            <span>Upload a file</span>
                                            <input id="file-upload" name="file-upload" type="file" class="sr-only">
                                        </label>
                                        <p class="pl-1">or drag and drop</p>
                                    </div>
                                    <p class="text-xs text-slate-500">PDF, DOCX up to 10MB</p>
                                </div>
                             </div>
                             ${isEdit ? `<p class="text-sm mt-2 text-slate-500">Current file: ${policy.attachment}</p>` : ''}
                        </div>
                        <div class="flex justify-end pt-4 gap-3">
                            <button type="button" id="form-cancel-btn" class="px-4 py-2 bg-white text-slate-700 border border-slate-300 rounded-md hover:bg-slate-50">Cancel</button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">${isEdit ? 'Submit Changes' : 'Submit for Review'}</button>
                        </div>
                    </form>
                `;
            }

            function openModal(title, body) {
                document.getElementById('modal-title').innerText = title;
                const modalBody = document.getElementById('modal-body');
                modalBody.innerHTML = body;

                const container = document.getElementById('modal-container');
                container.classList.remove('hidden');
                setTimeout(() => {
                    container.classList.remove('opacity-0');
                    container.querySelector('#modal-content').classList.remove('scale-95');
                }, 10);

                document.getElementById('modal-close-btn').onclick = closeModal;
                
                const cancelBtn = document.getElementById('form-cancel-btn');
                if (cancelBtn) cancelBtn.onclick = closeModal;
            }

            function closeModal() {
                const container = document.getElementById('modal-container');
                container.classList.add('opacity-0');
                container.querySelector('#modal-content').classList.add('scale-95');
                setTimeout(() => {
                    container.classList.add('hidden');
                }, 300);
            }

            render();
        });
    </script>
</body>
</html>
